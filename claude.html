<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Statistics Comparison</title>
    
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .controls label {
            margin-right: 10px;
            font-weight: 500;
        }
        
        .controls input[type="checkbox"] {
            margin-right: 5px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section h2 {
            color: #444;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .chart-container {
            width: 100%;
            height: 500px;
            margin-bottom: 30px;
        }
        
        #cityTable {
            width: 100% !important;
        }
        
        .dataTables_wrapper {
            padding: 0;
        }
        
        table.dataTable thead th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .metric-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            text-align: center;
        }
        
        .metric-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .metric-card .value {
            font-size: 28px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
            <a href="gemini.html">gemini</a> / 
<a href="perplexity.html">perplexity</a> / 
<a href="claude.html"><b>claude</b></a>
        <h1>Romanian City Statistics Comparison</h1>
        <div class="subtitle">Comparative analysis of amenities and infrastructure across major cities</div>
        
        <div class="metric-cards" id="metricCards"></div>
        
        <div class="controls">
            <label>
                <input type="checkbox" id="normalizePopulation"> 
                Normalize by Population (per 10,000 residents)
            </label>
        </div>
        
        <div class="section">
            <h2>üìä Comparison Table</h2>
            <table id="cityTable" class="display">
                <thead>
                    <tr>
                        <th>Category</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        
        <div class="section">
            <h2>üìà Category Comparison - Bar Chart</h2>
            <div id="barChart" class="chart-container"></div>
        </div>
        
        <div class="section">
            <h2>üéØ City Profiles - Radar Chart</h2>
            <div id="radarChart" class="chart-container"></div>
        </div>
        
        <div class="section">
            <h2>üèÜ Top Categories by City</h2>
            <div id="stackedChart" class="chart-container"></div>
        </div>
    </div>
    
    <!-- Libraries -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <script>
        let cityStats = [];
        let cityInfo = [];
        let dataTable;
        let isNormalized = false;
        
        // Load CSV files
        async function loadData() {
            try {
                const statsResponse = await fetch('data/city-stats-1.csv');
                const statsText = await statsResponse.text();
                const statsParsed = Papa.parse(statsText, { header: true });
                cityStats = statsParsed.data.filter(row => row.city);
                
                const citiesResponse = await fetch('data/cities.csv');
                const citiesText = await citiesResponse.text();
                const citiesParsed = Papa.parse(citiesText, { header: true });
                cityInfo = citiesParsed.data.filter(row => row.name);
                
                initializeApp();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }
        
        function getCityPopulation(cityName) {
            const city = cityInfo.find(c => c.name === cityName);
            return city ? parseFloat(city.pop) : null;
        }
        
        function normalizeValue(value, cityName) {
            if (!isNormalized) return value;
            const pop = getCityPopulation(cityName);
            if (!pop) return value;
            return (value / pop * 10000).toFixed(2);
        }
        
        function getProcessedData() {
            const categories = [...new Set(cityStats.map(s => s.category))];
            const cities = [...new Set(cityStats.map(s => s.city))];
            
            const tableData = categories.map(category => {
                const row = { category };
                cities.forEach(city => {
                    const stat = cityStats.find(s => s.category === category && s.city === city);
                    if (stat) {
                        const value = parseFloat(stat.count);
                        row[city] = normalizeValue(value, city);
                    } else {
                        row[city] = 0;
                    }
                });
                return row;
            });
            
            return { tableData, categories, cities };
        }
        
        function createMetricCards() {
            const cities = [...new Set(cityStats.map(s => s.city))];
            const cards = cities.map(city => {
                const cityData = cityStats.filter(s => s.city === city);
                const total = cityData.reduce((sum, s) => sum + parseFloat(s.count), 0);
                return `
                    <div class="metric-card">
                        <h3>${city}</h3>
                        <div class="value">${total.toLocaleString()}</div>
                        <div style="font-size: 12px; opacity: 0.9;">Total Facilities</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('metricCards').innerHTML = cards;
        }
        
        function createDataTable() {
            const { tableData, cities } = getProcessedData();
            
            if (dataTable) {
                dataTable.destroy();
            }
            
            const columns = [
                { data: 'category', title: 'Category' },
                ...cities.map(city => ({
                    data: city,
                    title: city,
                    render: (data) => parseFloat(data).toLocaleString()
                }))
            ];
            
            dataTable = $('#cityTable').DataTable({
                data: tableData,
                columns: columns,
                pageLength: 25,
                order: [[1, 'desc']],
                responsive: true
            });
        }
        
        function createBarChart() {
            const { tableData, categories, cities } = getProcessedData();
            const chart = echarts.init(document.getElementById('barChart'));
            
            const series = cities.map(city => ({
                name: city,
                type: 'bar',
                data: tableData.map(row => parseFloat(row[city]))
            }));
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' }
                },
                legend: {
                    data: cities,
                    top: 0
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: categories,
                    axisLabel: {
                        rotate: 45,
                        interval: 0
                    }
                },
                yAxis: {
                    type: 'value',
                    name: isNormalized ? 'Per 10k residents' : 'Count'
                },
                series: series
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }
        
        function createRadarChart() {
            const { tableData, categories, cities } = getProcessedData();
            const chart = echarts.init(document.getElementById('radarChart'));
            
            // Normalize data for radar chart (0-100 scale per category)
            const maxValues = categories.map(cat => {
                const row = tableData.find(r => r.category === cat);
                return Math.max(...cities.map(city => parseFloat(row[city])));
            });
            
            const indicator = categories.map((cat, idx) => ({
                name: cat,
                max: maxValues[idx] * 1.1 // Add 10% padding
            }));
            
            const series = cities.map(city => ({
                name: city,
                type: 'radar',
                data: [{
                    value: tableData.map(row => parseFloat(row[city])),
                    name: city
                }]
            }));
            
            const option = {
                tooltip: {},
                legend: {
                    data: cities,
                    top: 0
                },
                radar: {
                    indicator: indicator,
                    shape: 'polygon',
                    splitNumber: 4
                },
                series: series
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }
        
        function createStackedChart() {
            const { tableData, categories, cities } = getProcessedData();
            const chart = echarts.init(document.getElementById('stackedChart'));
            
            const series = categories.map(category => ({
                name: category,
                type: 'bar',
                stack: 'total',
                data: cities.map(city => {
                    const row = tableData.find(r => r.category === category);
                    return parseFloat(row[city]);
                })
            }));
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' }
                },
                legend: {
                    data: categories,
                    type: 'scroll',
                    top: 0
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: cities
                },
                yAxis: {
                    type: 'value',
                    name: isNormalized ? 'Per 10k residents' : 'Total Count'
                },
                series: series
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }
        
        function initializeApp() {
            createMetricCards();
            createDataTable();
            createBarChart();
            createRadarChart();
            createStackedChart();
            
            document.getElementById('normalizePopulation').addEventListener('change', (e) => {
                isNormalized = e.target.checked;
                createDataTable();
                createBarChart();
                createRadarChart();
                createStackedChart();
            });
        }
        
        // Load data on page load
        loadData();
    </script>
</body>
</html>
